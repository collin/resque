#!/usr/bin/env ruby -KU
require 'pathname'
require 'optparse'
require 'pp'
root = Pathname.new(__FILE__).dirname.expand_path + ".."

require 'rubygems'
require root+'lib/resque'
require root+'lib/resque/pool'

puts "Searching network for ResquePool peers (wait a moment)"

EventMachine.run do
  Resque::Pool.list do |list, peers|
    peers.each do |peer|
      pp peer.ip
      puts
      puts "fullname = #{peer.fullname}"
      puts "\tdomain = #{peer.domain}"
      puts "\tinterface = #{peer.interface}"
      puts "\tname = #{peer.name}"
      puts "\tport = #{peer.port}"
      puts "\ttarget = #{peer.target}"
      puts "\ttext_record = #{peer.text_record.inspect}"
      puts "\ttype = #{peer.type}"
      puts
    end   
    EventMachine.stop
  end
end
