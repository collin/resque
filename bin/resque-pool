#!/usr/bin/env ruby -KU
require 'pathname'
require 'optparse'
root = Pathname.new(__FILE__).dirname.expand_path + ".."

require 'rubygems'
require root+'lib/resque'
require root+'lib/resque/pool'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: resque-pool [options]"
  opts.on("-l", "--load PATH",
         "Path to a Ruby file to load into the worker runtime.") do |path|
    options[:path] = path
    require path
  end

  opts.on("-p", "--port PORT", Integer,
         "Port to use for this resque pool client. Default is 2395") do |port|
    options[:port] = port
  end
 
  opts.on("-b", "--bind ADDRESS",
         "Address to bind to for this resque pool client. Default is 0.0.0.0") do |bind_address|
    options[:bind_address] = bind_address
  end   
end.parse!

puts %{Missing option: --load PATH} if options[:path].nil?
exit(1) if options[:path].nil?

Resque::Pool.start(options)
